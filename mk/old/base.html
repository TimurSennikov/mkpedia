<!DOCTYPE html>
<html lang="en">
<title>{% block title %}{% endblock %}</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
<link rel="stylesheet" href="{{url_for('static', filename='styles.css')}}">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">MKPedik</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent"aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarContent">
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            {% if g.user %}
                <li class="nav-item">
                <span class="nav-link disabled" style="cursor: default; color: inherit;">{{ g.user["username"] }}</span>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/auth/logout">Выйти</a>
                </li>
            {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="/auth/register">Регистрация</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/auth/login">Вход</a>
                </li>
            {% endif %}
            </ul>
        </div>
    </div>
</nav>

<header>
    {% block header %} {% endblock %}
</header>

<body>
  <div class="container-fluid">
    <div class="row vh-100">
      <div class="col-auto d-flex align-items-center p-0" style="cursor: pointer; user-select: none;" onclick="toggleNavbar()">
        <div class="bg-secondary h-100 d-flex align-items-center" style="width: 20px;">
          <span class="text-white mx-auto">≡</span>
        </div>
      </div>

      <nav id="sidebar" class="col-md-2 bg-dark p-3">
        <h4>Список статей</h4>
        <div id="articlelist"></div>
      </nav>

        <main id="main-content">
            {% block content %} {% endblock %}
        </main>
    </div>
  </div>
</body>

<footer class="bg-dark text-white text-center py-3 fixed-bottom">
    {% block footer %}{% endblock %}
    <h5 class="mb-0"><a title="Стили чучуть подкоректировал шаш">©</a> 2025 MKPedik. Ничего не защищено. By Ben_Sralden</h5>
</footer>

<script>
    let cookies = {
        get: (name) => {
            let c = document.cookie;
            if(c == ""){return [];}

            let co = c.split("; ");
            co = co.map(cookie => {return cookie.split("=");});

            for(let i of co) {
                if(i[0].indexOf(name) == 0) {return i[1];}
            }
            
            return undefined;
        },

        set: (name, value) => {
            document.cookie = `${name}=${value}; path=/`;
        }
    };

    function toggleNavbar() {
        const sidebar = document.getElementById('sidebar');
        const mainContent = document.getElementById('main-content');

        sidebar.classList.toggle('collapsed');
        mainContent.classList.toggle('expanded');

        if(sidebar.classList.contains('collapsed')){cookies.set("navbar_state", "closed");}
        else{cookies.set("navbar_state", "open");}
    }

    function setup_bar() {
        barstatus = cookies.get("navbar_state");
        console.log(barstatus);

        if(barstatus == undefined) {cookies.set("navbar_state", "open");}
        else if(barstatus == "closed"){toggleNavbar();}
    }

    async function get_articles() {
        let article_list = document.getElementById("articlelist");

        let r = await(await fetch("/articles/rawlist")).json();

        for(article of r){
            let p = document.createElement("p");

            let art = document.createElement("a");
            art.innerHTML = article["title"];
            art.setAttribute("href", "/articles/article?article=" + article["title"]);

            p.appendChild(art);
            article_list.appendChild(p);
        }
    }

    setup_bar();
    get_articles();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
